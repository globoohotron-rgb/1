#!/usr/bin/env python3
# bin/ats — друкує universe path= exists= і делегує в інженерну побудову
import os, sys, argparse, subprocess

def main():
    ap = argparse.ArgumentParser(add_help=False)
    ap.add_argument('cmd', nargs='?', default='')
    ap.add_argument('--date', default=None)
    args, rest = ap.parse_known_args()

    if args.cmd != 'run':
        return subprocess.call(['python', 'tools\\apply_universe.py'] + sys.argv[1:])

    date = args.date or os.getenv('ATS_DATE') or __import__('datetime').date.today().strftime('%Y-%m-%d')
    uni_path = os.path.join('universe', f'{date}.csv')
    print(f'universe path={os.path.abspath(uni_path)} exists={os.path.exists(uni_path)}')

    return subprocess.call(['python', 'tools\\apply_universe.py', '--date', date])

if __name__ == '__main__':
    sys.exit(main())
